# 概述

对于今年全新的多人模式，平台与逻辑的对接方式与以往截然不同，本内容为迎合当前平台结构涉及的逻辑平台对接模式，希望学长别开喷，学弟别模仿。

# 模式

根据平台组的意思，本次平台模式大概是平台用C++建立一个模拟的python进程，利用相关接口黑箱式调用python的函数， 因此逻辑嵌在平台之内，逻辑要做的是对平台传来的数据进行处理并且传回平台所需的信息，因此逻辑不可能再像以往那样写主循环，循环由平台来写，逻辑仅作为一个模块提供回合刷新的方法。

由于逻辑是作为模块而非脚本，因此便利起见使用了全局变量来作为`GameMain`的实例。

# 接口函数

## game_init

输入工作路径与主配置文件名，作为平台启动后调用的第一个函数，用来生成航线并返回航线坐标。

## parachute

输入为选手信息以及他们选的着陆坐标，这个必须在所有选手选择后才能调用，数据包和解包交给平台负责，逻辑处理完信息后返回第一个回合的状态信息。

## game_main

输入信息为全部选手的指令（或者其他将来认为要用到的信息），逻辑首先调用`GameMain.unwrap_commands`解析指令，然后用`GameMain.refresh`处理并返回下一回合的状态信息，这是三个接口函数唯一一个要多次调用的函数。

# 对接细节

## 文件路径

由于不同工作路径下的文件路径差异，我采用传参的方式设置文件路径，在调用`game_init`时将一并指定主要配置文件所在路径与主要配置文件名，在主要配置文件中再给出其他配置文件的相对路径。

## 对接格式

`game_init`:平台启动这个函数时可给两个`string`型的参数作为主配置文件的父路径与主配置文件名，默认为`"./"`与`"config.ini"`。返回值传给平台`(start_position, over_position)`,其中两个`position`的格式均为`(int, int)`。

`parachute`:逻辑传给平台所有队伍选手的信息，中间包含队伍编号、角色编号、职业信息、跳伞坐标，格式为`{player_id:{'vocation': vocation_number, 'position': (x, y), 'team': team_id},...}`，其中`team_id`和`player_id`由平台钦定一系列编号数字，`vocation_number`是参考自`character.py`的职业枚举值。逻辑将回传第一回合的信息，信息格式与后面一致，见下。

`game_main`:其输入参数是平台传给逻辑的所有玩家指令信息，格式为`{player_id: [{"command_tye": type, "target": ID, "move_angle": angle, "view_angle": angle, "other": data},...]},...}`其中`player_number`应当是与前面钦定的一致的编号。返回值是逻辑传给平台的玩家需要获取到的信息，此处将直接传入一个列表，列表内容是玩家集成信息的对象，其内部包括一个玩家对象，一个视觉信息列表与一个听觉信息列表。

## debug

为了便于debug，我在内添置了面向print 的debug，并且在object.py内设置了变量`PRINT_DEBUG`作为debug的等级设定，为了方便起见这个等级将从主配置文件中读入。目前（2018年10月27日）只设置了1、2两个等级，等级1将会打印出选择职业的错误信息、选择坐标的错误信息，等级2在此基础之上还会打印出计算跳机点时若垂足超出地图的处理信息。以后新增的相关信息将在`PRINT_DEBUG`旁边的注释中列出。

默认的debug等级为1，平台可根据实际需求调整（非负整数），如果对于某些特定的信息有打印需求，可联系逻辑组提出。

## 变量表

此处给出了平台组需要实现的类、变量等内容，基本上也就是需要平台组呈递给选手的内容。

（但是现在暂时没空写，后面补坑）